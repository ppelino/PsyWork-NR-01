<!doctype html><html lang="pt-BR"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Campanhas — AVALIA NR01</title>
<link rel="stylesheet" href="assets/branding.css">
</head><body>
<nav><div class="wrap"><div class="logo"><img src="assets/logo.svg"><span>AVALIA NR01</span></div>
<div style="margin-left:auto"><a class="btn secondary" href="dashboard.html">Dashboard</a></div></div></nav>
<div class="container">
  <div class="card">
    <h2>Nova campanha</h2>
    <div class="grid">
      <div class="col-6"><input id="title" placeholder="Ex.: Avaliação Psicossocial 2025"></div>
      <div class="col-6"><input id="meta" placeholder='Metadados (JSON opcional): {"setores":["ADM","OP"],"periodo":"90d"}'></div>
    </div>
    <button class="btn" style="margin-top:12px" onclick="createCamp()">Criar</button>
  </div>
  <div class="card">
    <h2>Campanhas</h2>
    <table class="table" id="tbl"><thead><tr><th>Título</th><th>Link público</th><th>Status</th></tr></thead><tbody></tbody></table>
  </div>
</div>
<div class="footer">© 2025 AVALIA NR01</div>
<script>
let token = localStorage.getItem('token'); if(!token) location.href='index.html';
async function list(){
  const camps = await fetch('/api/campaigns',{headers:{Authorization:'Bearer '+token}}).then(r=>r.json());
  const tbody=document.querySelector('#tbl tbody'); tbody.innerHTML='';
  camps.forEach(c=>{
    const tr=document.createElement('tr');
    const link = location.origin + '/frontend/survey.html?token=' + c.token;
    tr.innerHTML = '<td>'+c.title+'</td><td><a href="'+link+'" target="_blank">'+link+'</a></td><td>'+(c.active?'Ativa':'Inativa')+'</td>';
    tbody.appendChild(tr);
  });
}
async function createCamp(){
  const payload={title:title.value, meta: meta.value? JSON.parse(meta.value): {}};
  const res = await fetch('/api/campaigns',{method:'POST', headers:{'Content-Type':'application/json', Authorization:'Bearer '+token}, body:JSON.stringify(payload)});
  if(!res.ok){ alert('Erro ao criar'); return;}
  list();
}
list();
</script>
</body></html>